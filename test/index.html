<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
       
    </style>
</head>
<body>

    <h1 id="output"></h1>
    <script>
        // --- CONFIG ---
        const SHEET_ID = '1_Eb5Vu48WsYYB9KxhhRM7BGf_d2blgmBDDM6TNby-RA';
        const TAB_ID = '0';
        // --- END CONFIG ---

        const dataUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${TAB_ID}`;

        /**
         * Cleans the bogus JSONP wrapper from Google's response.
         */
        function cleanGoogleJsonResponse(text) {
            const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\)/s);
            if (!jsonMatch || !jsonMatch[1]) {
                throw new Error("D'oh! Couldn't parse the Google JSONP response.");
            }
            return JSON.parse(jsonMatch[1]);
        }

        /**
         * Formats the cooked Google Viz data into a nice, clean array of STRINGS.
         * This version is hard-coded to only grab data from the first column (Column A).
         * @param {object} gvizData - The parsed JSON data from cleanGoogleJsonResponse.
         * @returns {Array<string>} - A clean array, like [ "Gift one", "Gift two" ]
         */
        function formatGvizData(gvizData) {
            const dataTable = gvizData.table;
            
            // We don't need no stinkin' headers!
            
            const values = dataTable.rows.map(row => {
                // 'c' is the array of cells. We just want the first one (index 0).
                const firstCell = row.c[0]; 
                
                // 'v' is the value. Just return that, mate.
                // We'll check if the cell exists, just in case of empty rows.
                return firstCell ? firstCell.v : null;
            });

            // Let's filter out any 'null' values from empty rows, 'cause that's lame.
            return values.filter(v => v !== null);
        }

        /**
         * Main function to fetch and display the data
         */
        async function loadData() {
            console.log('Fetching data, mate...');
            const outputEl = document.getElementById('output');

            try {
                const response = await fetch(dataUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const text = await response.text();
                const jsonData = cleanGoogleJsonResponse(text);
                
                // This is our new, simple array
                const availablegift = formatGvizData(jsonData); 
                
                // Hell yeah, success!
                console.log('--- Bitchin\' Formatted Array ---');
                console.log(availablegift);

                // Chuck it on the page
                outputEl.textContent = JSON.stringify(availablegift, null, 2);

            } catch (error) {
                console.error('Totally cooked it, brah:', error);
                outputEl.textContent = `Totally cooked it: ${error.message}`;
            }
        }

        // Run the hack!
        loadData();

    </script>
</body>
</html>
